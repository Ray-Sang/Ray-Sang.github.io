<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Effective C++ ç¬”è®°ï¼ˆå¾…ç»­ï¼‰ | Ray&#39;s Space</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://ray-sang.github.io/favicon.ico?v=1635947554761">
<link rel="stylesheet" href="https://ray-sang.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ğŸ˜€

å‚è€ƒï¼šhttps://www.cnblogs.com/xiaojianliu/p/12693603.html
Part 1 Accusting yourself to C++
å‚è€ƒï¼šhttps://blog.csdn.net/lm4..." />
    <meta name="keywords" content="C++åŸºç¡€" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://ray-sang.github.io">
        <img src="https://ray-sang.github.io/images/avatar.png?v=1635947554761" class="site-logo">
        <h1 class="site-title">Ray&#39;s Space</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      Plain living and high thinking
    </div>
    <div class="site-footer">
      Photography enthusiastic @<a href="https://500px.com.cn/sangray" target="_blank">500px</a> | <a class="rss" href="https://ray-sang.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Effective C++ ç¬”è®°ï¼ˆå¾…ç»­ï¼‰</h2>
            <div class="post-date">2021-09-05</div>
            
            <div class="post-content" v-pre>
              <p>ğŸ˜€</p>
<!-- more -->
<p>å‚è€ƒï¼šhttps://www.cnblogs.com/xiaojianliu/p/12693603.html</p>
<h1 id="part-1-accusting-yourself-to-c">Part 1 Accusting yourself to C++</h1>
<p>å‚è€ƒï¼šhttps://blog.csdn.net/lm409/article/details/72059362</p>
<h2 id="item-1">Item 1</h2>
<h2 id="item-2">Item 2</h2>
<pre><code class="language-c++">// å‡è®¾fä¸º
int f(int num) { return num; }

#define CALL_WITH_MAX(a, b) f((a) &gt; (b) ? (a) : (b))
// ä¸ºæ‰€æœ‰å®ä¸­çš„å®å‚éƒ½åŠ ä¸Šå°æ‹¬å·
int main(){
	int a = 5, b = 0;
	CALL_WITH_MAX(++a, b); // a è¢«ç´¯åŠ äºŒæ¬¡ï¼Œa == 7ï¼Œ å‡½æ•°è¿”å›7
	CALL_WITH_MAX(++a, b+10); // a è¢«ç´¯åŠ ä¸€æ¬¡ï¼Œa == 8ï¼Œ å‡½æ•°è¿”å›10
	
	return 0;
}
</code></pre>
<p>è®°ä½ï¼š</p>
<ul>
<li>å•çº¯å¸¸é‡ä½¿ç”¨constå¯¹è±¡æˆ–enum{}æ›¿æ¢#definesã€‚</li>
<li>å½¢ä¼¼å‡½æ•°çš„å®ï¼ˆmacrosï¼‰ï¼Œæ”¹ç”¨inlineå‡½æ•°æ›¿æ¢#definesã€‚</li>
</ul>
<h2 id="item-3-use-const-wherever-possible">Item 3 Use const wherever possible</h2>
<p>constçš„çº¦æŸï¼ˆç”±ä½ç½®å†³å®šï¼‰ï¼š</p>
<pre><code class="language-c++">char greeting[] = &quot;Hello&quot;;
char* p = greeting; // non-const ptr, non-const data;
const char* p = greeting; // non-const ptr, const data;
char* const p = greeting; // const ptr, non-const data;
const char* const p = greeting; // const ptr, const data;
</code></pre>
<p>å¦‚æœconstå‡ºç°åœ¨æ˜Ÿå·å·¦è¾¹ï¼Œè¡¨ç¤ºè¢«æŒ‡ç‰©æ˜¯å¸¸é‡ï¼›å¦‚æœå‡ºç°åœ¨æ˜Ÿå·å³è¾¹ï¼Œè¡¨ç¤ºæŒ‡é’ˆè‡ªèº«æ˜¯å¸¸é‡ï¼›ä¸¤è¾¹ï¼Œè¡¨ç¤ºè¢«æŒ‡ç‰©å’ŒæŒ‡é’ˆè‡ªèº«éƒ½æ˜¯å¸¸é‡ã€‚æ³¨æ„ï¼Œå¦‚æœè¢«æŒ‡ç‰©æ˜¯å¸¸é‡ï¼Œå…³é”®å­—constå†™åœ¨ç±»å‹ä¹‹å‰ä¹Ÿå¯ä»¥ï¼Œå³ä»¥ä¸‹ä¸¤ç§å†™æ³•ç›¸åŒï¼š</p>
<pre><code class="language-c++">void f1(const Widget* pw);
void f2(Widget const * pw);
</code></pre>
<p>é¢å¯¹å‡½æ•°å£°æ˜æ—¶ï¼Œä½¿ç”¨consté™å®šå‡½æ•°è¿”å›å¸¸é‡å€¼ï¼Œé¿å…å‡ºç°ä¸å¿…è¦çš„å¯èƒ½çš„èµ‹å€¼è¡Œä¸ºï¼ˆé¿å…è¢«å·¦å€¼ï¼‰ï¼Œé¿å…ä¸å†…ç½®ç±»å‹çš„ä¸å…¼å®¹ï¼Œå¦‚ï¼š</p>
<pre><code class="language-c++">class Rational{...};
const Rational operator*(const Rational&amp; lhs, const Rational&amp; rhs);

Rational a, b, c;
...
if(a*b = c)... // typo of ==, occuring unnecessary assignment
</code></pre>
<p>å°†conståº”ç”¨äºæˆå‘˜å‡½æ•°ï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>ä½¿classæ¥å£å®¹æ˜“è¢«ç†è§£ï¼Œå¾—çŸ¥å“ªä¸ªå‡½æ•°å¯ä»¥æ”¹åŠ¨å¯¹è±¡å†…å®¹ï¼Œè€Œå“ªä¸ªä¸è¡Œã€‚</li>
<li>ä½¿â€œæ“ä½œconstå¯¹è±¡â€æˆä¸ºå¯èƒ½ã€‚å‰ææ˜¯ï¼šæœ‰constæˆå‘˜å‡½æ•°å¯ç”¨æ¥å¤„ç†å–å¾—çš„constå¯¹è±¡ã€‚ä½¿ç”¨å‡½æ•°é‡è½½ï¼Œå¯¹constå’Œnon-constå¯¹è±¡è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</li>
</ul>
<h2 id="item-4-initialize-objects-before-used">Item 4 Initialize objects before used</h2>
<p>åŒºåˆ†èµ‹å€¼ä¸åˆå§‹åŒ–ï¼ˆåœ¨ç±»ä¸­ï¼‰ï¼Œèµ‹å€¼ï¼š</p>
<pre><code class="language-c++">class PhoneNumber{...};
class ABEntry{
public:
	ABEntry(const std::string&amp; name, const std::string&amp; address, const std::list&lt;PhoneNumber&gt;&amp; phones);
private:
	std::string theName;
	std::string theAddress;
	std::list&lt;PhoneNumber&gt; thePhones;
	int numTimesConsulted;
};
// æ³¨æ„ï¼Œè¿™ä¸æ˜¯åˆå§‹åŒ–initializationï¼Œæ˜¯èµ‹å€¼assignments
ABEntry::ABEntry(const std::string&amp; name, const std::string&amp; address, const std::list&lt;PhoneNumber&gt;&amp; phones){
	theName = name;
	theAddress = address;
	thePhones = phones;
	numTimesConsulted = 0;
}
</code></pre>
<p>è€ŒC++è§„å®šï¼Œå¯¹è±¡çš„æˆå‘˜å˜é‡çš„åˆå§‹åŒ–åŠ¨ä½œå‘ç”Ÿåœ¨è¿›å…¥æ„é€ å‡½æ•°æœ¬ä½“ä¹‹å‰ã€‚ä½¿ç”¨member initialization listæ›¿æ¢èµ‹å€¼æ“ä½œï¼ˆå¦‚æœå¤šé‡ç»§æ‰¿ï¼Œä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ˜¯é¿å…è¿·æƒ‘ç¼–è¯‘å™¨çš„å”¯ä¸€åŠæ³•ï¼‰ï¼š</p>
<pre><code class="language-c++">ABEntry::ABEntry(const std::string&amp; name, const std::string&amp; address, const std::list&lt;PhoneNumber&gt;&amp; phones) :
	theName(name), // åªè°ƒç”¨ä¸€æ¬¡copyæ„é€ å‡½æ•°
	theAddress(address),
	thePhones(phones),
	numTimesConsulted(0)
{ }
</code></pre>
<p>å¦‚æœæˆå‘˜å˜é‡æ˜¯constæˆ–è€…referencesï¼Œä»–ä»¬å°±ä¸€å®šéœ€è¦åˆå€¼ï¼Œä¸èƒ½è¢«èµ‹å€¼ã€‚æ€»æ˜¯ä½¿ç”¨æˆå‘˜åˆå€¼åˆ—å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</p>
<p>æ¡æ¬¾4æœ€åæ²¡çœ‹æ‡‚ã€‚å…ˆè¿‡ã€‚</p>
<h1 id="part-2-constuctors-destructors-and-assignment-operators">Part 2 Constuctors, Destructors, and Assignment Operators</h1>
<p>å‚è€ƒï¼šhttps://blog.csdn.net/lm409/article/details/72598020</p>
<h2 id="item-5-know-what-functions-c-silently-writes-and-calls">Item 5 Know what functions C++ silently writes and calls</h2>
<p>C++ç¼–è¯‘å™¨ä¼šä¸ºä¸€ä¸ªç©ºç±»å£°æ˜ï¼ˆç¼–è¯‘å™¨ç‰ˆæœ¬çš„ï¼‰ä¸€ä¸ªcopyæ„é€ å‡½æ•°ã€ä¸€ä¸ªcopy assignmentæ“ä½œç¬¦å’Œä¸€ä¸ªææ„å‡½æ•°ã€‚æ­¤å¤–ï¼Œå¦‚æœæ²¡æœ‰å£°æ˜ä»»ä½•æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šå£°æ˜ä¸€ä¸ªdefaultæ„é€ å‡½æ•°ã€‚æ‰€æœ‰è¿™äº›å‡½æ•°éƒ½æ˜¯publicä¸”inlineã€‚å³å¦‚æœä½ å†™ä¸‹ï¼š</p>
<pre><code class="language-c++">class Empty{};
</code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre><code class="language-c++">class Empty{
public:
	Empty(){...} // default constructor
	Empty(const Empty&amp; rhs){...} // copy constructor
	~Empty(){...} // destructor, æ˜¯å¦è¯¥æ˜¯virtualè§ç¨åè¯´æ˜
	
	Empty&amp; operator=(const Empty&amp; rhs){...} // copy assignment operator
};
</code></pre>
<p>åªæœ‰è¿™äº›å‡½æ•°è¢«éœ€è¦ï¼ˆè¢«è°ƒç”¨ï¼‰æ—¶ï¼Œæ‰ä¼šè¢«ç¼–è¯‘å™¨åˆ›å»ºå‡ºæ¥ã€‚</p>
<p>C++ä¸å…è®¸â€œè®©å¼•ç”¨æ”¹æŒ‡å‘ä¸åŒå¯¹è±¡â€ï¼Œæœ¬è´¨ä¸Šå¼•ç”¨è¿˜æ˜¯å–åœ°å€ï¼Œå·¦å€¼ä¸å¯ä»¥è¢«ä¿®æ”¹ã€‚C++çš„é»˜è®¤copy assignmentä¼šè¢«æ‹’ç»ç¼–è¯‘çš„æƒ…å†µï¼š</p>
<ul>
<li>åœ¨â€œå†…å«referenceæˆå‘˜â€çš„classå†…æ”¯æŒèµ‹å€¼æ“ä½œï¼ˆassignmentï¼‰ã€‚</li>
<li>æ›´æ”¹constæˆå‘˜ã€‚</li>
<li>å¦‚æœæŸä¸ªbase classeså°†copy assignmentæ“ä½œç¬¦å£°æ˜ä¸ºprivateï¼Œç¼–è¯‘å™¨å°†æ‹’ç»ä¸ºå…¶derived classesç”Ÿæˆä¸€ä¸ªcopy assignmentæ“ä½œç¬¦ã€‚</li>
</ul>
<p>æ€»ç»“ï¼šå¦‚æœæ‰“ç®—åœ¨ä¸€ä¸ªâ€œå†…å«referenceæˆå‘˜â€çš„ class å†…æ”¯æŒèµ‹å€¼æ“ä½œï¼Œå¿…é¡»è‡ªå·±å®šä¹‰copy assignmentæ“ä½œç¬¦ï¼›é¢å¯¹â€œå†…å«constæˆå‘˜â€çš„classesï¼Œç¼–è¯‘å™¨çš„ååº”ä¹Ÿä¸€æ ·ï¼ˆæ‹’ç»ç¼–è¯‘è¯¥è¡ŒåŠ¨ä½œï¼‰ï¼Œå› ä¸ºæ›´æ”¹constæˆå‘˜æ˜¯ä¸åˆæ³•çš„ï¼›å¦‚æœæŸä¸ª base classes å°†copy assignmentæ“ä½œç¬¦å£°æ˜ä¸º privateï¼Œç¼–è¯‘å™¨å°†æ‹’ç»ä¸ºå…¶ derived classes ç”Ÿæˆ copy assignment æ“ä½œç¬¦ã€‚</p>
<h2 id="item-6-è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°å°±æ”¹æ˜ç¡®æ‹’ç»">Item 6 è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œå°±æ”¹æ˜ç¡®æ‹’ç»</h2>
<p>éœ€æ±‚ï¼šé˜»æ­¢æŸäº›å¯¹è±¡æ‹·è´æ“ä½œï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆæ‹·è´æ„é€ å‡½æ•°å’Œcopy assignmentã€‚</p>
<p>å°†æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦å£°æ˜ä¸ºç§æœ‰çš„ã€‚é€šè¿‡æ˜¾å¼å£°æ˜ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œå¯ä»¥é˜²æ­¢ç¼–è¯‘å™¨ç”Ÿæˆå®ƒè‡ªå·±çš„ç‰ˆæœ¬ï¼Œè€Œä¸”å°†è¿™ä¸ªå‡½æ•°å£°æ˜ä¸ºç§æœ‰çš„ï¼Œå¯ä»¥é˜²æ­¢åˆ«äººè°ƒç”¨å®ƒã€‚</p>
<p>é€šå¸¸ï¼Œè¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸ååˆ†ä¿é™©ï¼Œå› ä¸ºæˆå‘˜å’Œå‹å…ƒå‡½æ•°è¿˜æ˜¯èƒ½å¤Ÿè°ƒç”¨ä½ çš„ private å‡½æ•°ã€‚æ¢å¥è¯è¯´ï¼Œé™¤éä½ ååˆ†èªæ˜åœ°ä¸å®šä¹‰å®ƒä»¬ã€‚é‚£ä¹ˆï¼Œå½“æœ‰äººä¸å°å¿ƒåœ°è°ƒç”¨äº†å®ƒä»¬ï¼Œåœ¨ link-timeï¼ˆé“¾æ¥æ—¶ï¼‰ä¼šå‡ºç°é”™è¯¯ã€‚è¿™ä¸ªçªé—¨â€”â€”å£°æ˜æˆå‘˜å‡½æ•°ä¸º private å´æ•…æ„ä¸å»å®ç°å®ƒç¡®å®å¾ˆå¥½ã€‚</p>
<pre><code class="language-c++">class HomeForSale {
public:
  ...
private:
  ...
  //@ declarations only åªå£°æ˜ä¸å®ç°
  HomeForSale(const HomeForSale&amp;);           
  HomeForSale&amp; operator=(const HomeForSale&amp;);
};
</code></pre>
<p>å¯¹äºä¸Šé¢çš„ç±»å®šä¹‰ï¼Œç¼–è¯‘å™¨å°†é˜»æ­¢å®¢æˆ·æ‹·è´å¯¹è±¡çš„ä¼å›¾ï¼Œå¦‚æœä½ ä¸å°å¿ƒåœ¨æˆå‘˜æˆ–å‹å…ƒå‡½æ•°ä¸­è¿™æ ·åšäº†ï¼Œè¿æ¥ç¨‹åºä¼šæå‡ºæŠ—è®®ã€‚</p>
<p>é€šå¸¸çš„æ–¹å¼æ•…æ„è®¾è®¡ä¸€ä¸ªåŸºç±»ï¼š</p>
<pre><code class="language-c++">class Uncopyable {
protected:                                  
  Uncopyable() {}                           
  ~Uncopyable() {}                          

private:
 //@but prevent copying
  Uncopyable(const Uncopyable&amp;);             
  Uncopyable&amp; operator=(const Uncopyable&amp;);
};
</code></pre>
<p>æ­¤æ—¶ HomeForSale å¯ä»¥ä»è¯¥åŸºç±»ç»§æ‰¿ï¼š</p>
<pre><code class="language-c++">class HomeForSale: private Uncopyable {      
  ...                                        
};  
</code></pre>
<p>è¿™æ ·åšæ˜¯å› ä¸ºï¼Œå¦‚æœæœ‰äººâ€”â€” æˆå‘˜å‹å…ƒå‡½æ•°è¯•å›¾æ‹·è´ä¸€ä¸ª HomeForSale å¯¹è±¡ï¼Œç¼–è¯‘å™¨å°†è¯•å›¾ç”Ÿæˆä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°å’Œä¸€ä¸ªæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€‚è¿™äº›å‡½æ•°çš„ç¼–è¯‘å™¨ç”Ÿæˆç‰ˆä¼šè¯•å›¾è°ƒç”¨åŸºç±»çš„ç›¸åº”å‡½æ•°ï¼Œè€Œè¿™äº›è°ƒç”¨å°†è¢«æ‹’ç»ï¼Œå› ä¸ºåœ¨ åŸºç±»ä¸­ï¼Œæ‹·è´æ“ä½œæ˜¯ç§æœ‰çš„ã€‚</p>
<p>Uncopyable çš„å®ç°å’Œä½¿ç”¨åŒ…å«ä¸€äº›å¾®å¦™ä¹‹å¤„ï¼Œæ¯”å¦‚ï¼Œä» Uncopyable ç»§æ‰¿ä¸å¿…æ˜¯ publicçš„ï¼Œè€Œä¸” Uncopyable çš„ ææ„å‡½æ•°ä¸å¿…æ˜¯ virtual çš„ã€‚å› ä¸º Uncopyable ä¸åŒ…å«æ•°æ®ã€‚</p>
<p>æ€»ç»“ï¼šä¸ºäº†æ‹’ç»ç¼–è¯‘å™¨è‡ªåŠ¨æä¾›çš„æœºèƒ½ï¼Œå°†ç›¸åº”çš„æˆå‘˜å‡½æ•°å£°æ˜ä¸º privateï¼Œè€Œä¸”ä¸è¦ç»™å‡ºå®ç°ã€‚ä½¿ç”¨ä¸€ä¸ªç±»ä¼¼ Uncopyable çš„åŸºç±»æ˜¯æ–¹æ³•ä¹‹ä¸€ã€‚</p>
<h2 id="item-7-ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°-declare-destructors-virtual-in-polymorphic-base-classes">Item 7 ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•° Declare destructors virtual in polymorphic base classes</h2>
<p>æœ‰å¾ˆå¤šæ–¹æ³•å–å¾—æ—¶é—´ï¼Œæ‰€ä»¥æœ‰å¿…è¦å»ºç«‹ä¸€ä¸ªåŸºç±»ï¼Œå¹¶ä¸ºä¸åŒçš„è®¡æ—¶æ–¹æ³•å»ºç«‹æ´¾ç”Ÿç±»ï¼š</p>
<pre><code class="language-c++">class TimeKeeper {
public:
  TimeKeeper();
  ~TimeKeeper();
  ...
};

class AtomicClock: public TimeKeeper { ... };
class WaterClock: public TimeKeeper { ... };
class WristWatch: public TimeKeeper { ... };

//@ ä½¿ç”¨æ—¶
TimeKeeper *ptk = getTimeKeeper();  
...                         
delete ptk;                        
</code></pre>
<p><code>getTimeKeeper</code> è¿”å›ä¸€ä¸ªæŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡çš„æŒ‡é’ˆï¼ˆæ¯”å¦‚ <code>AtomicClock</code>)ï¼Œé‚£ä¸ªå¯¹è±¡ç»ç”±ä¸€ä¸ªåŸºç±»æŒ‡é’ˆä¹Ÿå°±æ˜¯ä¸€ä¸ª<code>TimeKeeper* pointer</code> è¢«åˆ é™¤ï¼Œè€Œä¸”è¿™ä¸ªåŸºç±»éè™šæ‹Ÿææ„å‡½æ•°ã€‚ç¥¸ç«¯å°±åœ¨è¿™é‡Œï¼Œå› ä¸º C++ è§„å®šï¼š<strong>å½“ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæŒ‡å‘å¸¦æœ‰éè™šæ‹Ÿææ„å‡½æ•°çš„åŸºç±»çš„æŒ‡é’ˆè¢«åˆ é™¤ï¼Œåˆ™ç»“æœæ˜¯æœªå®šä¹‰çš„ã€‚</strong> è¿è¡Œæ—¶æ¯”è¾ƒå…¸å‹çš„åæœæ˜¯è¿™ä¸ªå¯¹è±¡çš„æ´¾ç”Ÿéƒ¨åˆ†ä¸ä¼šè¢«ææ„ã€‚å¦‚æœ <code>getTimeKeeper</code> è¿”å›ä¸€ä¸ªæŒ‡å‘ <code>AtomicClock</code> å¯¹è±¡çš„æŒ‡é’ˆï¼Œåˆ™å¯¹è±¡çš„ <code>AtomicClock</code> éƒ¨åˆ†ä¹Ÿå°±æ˜¯åœ¨ <code>AtomicClock class</code> ä¸­å£°æ˜çš„æ•°æ®æˆå‘˜å¾ˆå¯èƒ½ä¸ä¼šè¢«ææ„ï¼Œ<code>AtomicClock</code> çš„ææ„å‡½æ•°ä¹Ÿä¸ä¼šè¿è¡Œã€‚ç„¶è€Œï¼ŒåŸºç±»éƒ¨åˆ†ï¼ˆä¹Ÿå°±æ˜¯ <code>TimeKeeper</code> éƒ¨åˆ†ï¼‰å¾ˆå¯èƒ½å·²è¢«ææ„ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€ä¸ªå¤æ€ªçš„â€œéƒ¨åˆ†è¢«ææ„â€å¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªå¯¼è‡´æ³„æ¼èµ„æºã€‚</p>
<p>å‚è€ƒï¼šhttps://www.zhihu.com/question/25572937/answer/34439248</p>
<p>æ¶ˆé™¤è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼šç»™åŸºç±»ä¸€ä¸ªè™šæ‹Ÿææ„å‡½æ•°ã€‚äºæ˜¯ï¼Œåˆ é™¤ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡çš„æ—¶å€™å°±æœ‰äº†ä½ æ‰€æœŸæœ›çš„è¡Œä¸ºã€‚å°†ææ„æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å…¨éƒ¨çš„æ´¾ç”Ÿç±»æ„ä»¶ï¼š</p>
<pre><code class="language-c++">class TimeKeeper {
public:
  TimeKeeper();
  virtual ~TimeKeeper(); //
  ...
};

TimeKeeper *ptk = getTimeKeeper();
...
delete ptk;  
</code></pre>
<p>ç±»ä¼¼ TimeKeeper çš„åŸºç±»ä¸€èˆ¬éƒ½åŒ…å«é™¤äº†ææ„å‡½æ•°ä»¥å¤–çš„å…¶å®ƒè™šæ‹Ÿå‡½æ•°ï¼Œå› ä¸ºè™šæ‹Ÿå‡½æ•°çš„ç›®çš„å°±æ˜¯å…è®¸æ´¾ç”Ÿç±»å®ç°çš„<strong>å®šåˆ¶åŒ–</strong>ã€‚ä¾‹å¦‚ï¼ŒTimeKeeper å¯ä»¥æœ‰ä¸€ä¸ªè™šæ‹Ÿå‡½æ•° getCurrentTimeï¼Œå®ƒåœ¨å„ç§ä¸åŒçš„æ´¾ç”Ÿç±»ä¸­æœ‰ä¸åŒçš„å®ç°ã€‚å‡ ä¹æ‰€æœ‰æ‹¥æœ‰è™šæ‹Ÿå‡½æ•°çš„ç±»å·®ä¸å¤šéƒ½åº”è¯¥æœ‰ä¸€ä¸ªè™šæ‹Ÿææ„å‡½æ•°ã€‚</p>
<p>**å¦‚æœä¸€ä¸ªç±»ä¸åŒ…å«è™šæ‹Ÿå‡½æ•°ï¼Œè¿™ç»å¸¸é¢„ç¤ºä¸æ‰“ç®—å°†å®ƒä½œä¸ºåŸºç±»ä½¿ç”¨ã€‚å½“ä¸€ä¸ªç±»ä¸æ‰“ç®—ä½œä¸ºåŸºç±»æ—¶ï¼Œå°†ææ„å‡½æ•°è™šæ‹Ÿé€šå¸¸æ˜¯ä¸ªåä¸»æ„ã€‚**ä¼šé€ æˆç©ºé—´å ç”¨çš„å¢åŠ ã€‚</p>
<p>è¦æ³¨æ„æ‰€æœ‰ä¸å¸¦virtualææ„å‡½æ•°çš„ç±»ï¼Œæ¯”å¦‚æ‰€æœ‰çš„STLå®¹å™¨ï¼ˆvectorã€listã€setç­‰ç­‰ï¼‰ï¼Œä¸èƒ½å°†å…¶ä½œä¸ºbase classï¼Œç„¶åç»ç”±åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-c++">class SpecialString: public std::string {   // bad idea! std::string has a non-virtual destructor
  ...                                       
};
</code></pre>
<p>ä¸€çœ¼çœ‹ä¸Šå»ï¼Œè¿™å¯èƒ½æ— ä¼¤å¤§é›…ï¼Œä½†æ˜¯ï¼Œå¦‚æœåœ¨ç¨‹åºçš„æŸä¸ªåœ°æ–¹å› ä¸ºæŸç§åŸå› ï¼Œä½ å°†ä¸€ä¸ªæŒ‡å‘ SpecialString çš„æŒ‡é’ˆè½¬å‹ä¸ºä¸€ä¸ªæŒ‡å‘ string çš„æŒ‡é’ˆï¼Œç„¶åä½ å°† delete æ–½åŠ äºè¿™ä¸ªæŒ‡é’ˆï¼Œä½ å°±ç«‹åˆ»è¢«æ”¾é€åˆ°æœªå®šä¹‰è¡Œä¸ºçš„é¢†åœ°ï¼š</p>
<pre><code class="language-c++">SpecialString *pss =   new SpecialString(&quot;Impending Doom&quot;);
std::string *ps;
...
ps = pss;   
...
delete ps;    //@ undefined! In practice, *ps's SpecialString resources will be leaked, because the SpecialString destructor won't be called.
</code></pre>
<p>æœ‰æ—¶å€™ï¼Œç»™ä¸€ä¸ªç±»æä¾›ä¸€ä¸ªpure virtual çº¯è™šæ‹Ÿææ„å‡½æ•°èƒ½æä¾›ä¸€äº›ä¾¿åˆ©ï¼Œä¼šå¯¼è‡´ abstract class ï¼ˆæŠ½è±¡ç±»ï¼‰â€”â€”ä¹Ÿå°±æ˜¯ä¸èƒ½å®ä½“åŒ–çš„ç±»ï¼Œå¾€å¾€è¢«å½“åšbase classæ¥ç”¨ï¼Œæ³¨æ„ç»™çº¯è™šææ„å‡½æ•°æä¾›ä¸€ä»½å®šä¹‰ï¼Œå¦åˆ™è¿æ¥å™¨ä¼šæŠ¥é”™ã€‚ï¼ˆå› ä¸ºC++çš„ææ„é¡ºåºï¼‰</p>
<pre><code class="language-c++">class AWOV  {  
public:  
    virtual ~AWOV() = 0;  //å£°æ˜çº¯è™šææ„å‡½æ•°
}; 

AWOV::~AWOV()  {  } //å®šä¹‰çº¯è™šææ„å‡½æ•°
</code></pre>
<p>æ€»ç»“ï¼šå¤šæ€åŸºç±»åº”è¯¥å£°æ˜è™šæ‹Ÿææ„å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªç±»æœ‰ä»»ä½•è™šæ‹Ÿå‡½æ•°ï¼Œå®ƒå°±åº”è¯¥æœ‰ä¸€ä¸ªè™šæ‹Ÿææ„å‡½æ•°ï¼›ä¸æ˜¯è®¾è®¡ç”¨æ¥ä½œä¸ºåŸºç±»æˆ–ä¸æ˜¯è®¾è®¡ç”¨äºå¤šæ€çš„ç±»å°±ä¸åº”è¯¥å£°æ˜è™šæ‹Ÿææ„å‡½æ•°ã€‚</p>
<h2 id="item-8-ææ„å‡½æ•°ä¸­å‘ç”Ÿå¼‚å¸¸æ˜¯ä»¶æ£˜æ‰‹çš„äº‹-prevent-exceptions-from-leaving-destructors">Item 8 ææ„å‡½æ•°ä¸­å‘ç”Ÿå¼‚å¸¸æ˜¯ä»¶æ£˜æ‰‹çš„äº‹ Prevent exceptions from leaving destructors</h2>
<p>ç”±äºææ„å‡½æ•°å¸¸å¸¸è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œåœ¨ææ„å‡½æ•°ä¸­æŠ›å‡ºçš„å¼‚å¸¸å¾€å¾€ä¼šéš¾ä»¥æ•è·ï¼Œå¼•å‘ç¨‹åºéæ­£å¸¸é€€å‡ºæˆ–æœªå®šä¹‰è¡Œä¸ºã€‚</p>
<pre><code class="language-c++">class Widget {
public:
  ...
  ~Widget() { ... } // å‡è®¾è¿™ä¸ªå¯èƒ½åå‡ºä¸€ä¸ªå¼‚å¸¸
};

void doSomething()
{
  std::vector&lt;Widget&gt; v;
  ...
} // v åœ¨è¿™é‡Œè¢«è‡ªåŠ¨é”€æ¯
</code></pre>
<p>å½“ v è¢«ææ„æ—¶ï¼Œå®ƒæœ‰è´£ä»»ææ„å®ƒåŒ…å«çš„æ‰€æœ‰ Widgetsã€‚å‡è®¾ v ä¸­æœ‰åä¸ª Widgetsï¼Œåœ¨ç¬¬ä¸€ä¸ªçš„ææ„è¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚å…¶å®ƒ 9 ä¸ª Widgets ä»ç„¶å¿…é¡»è¢«ææ„ï¼Œå¦åˆ™å®ƒä»¬æŒæœ‰çš„æ‰€æœ‰èµ„æºå°†è¢«æ³„æ¼ï¼Œå› æ­¤C++è°ƒç”¨ä»–ä»¬å„ä¸ªææ„å‡½æ•°ã€‚ä½†å‡è®¾åœ¨é‚£äº›è°ƒç”¨æœŸé—´ï¼Œç¬¬äºŒä¸ªWidgetsææ„å‡½æ•°åˆæŠ›å‡ºå¼‚å¸¸ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªåŒæ—¶ä½œç”¨çš„å¼‚å¸¸ï¼Œè¿™å¯¹äºC++æ¥è¯´å¤ªå¤šäº†ã€‚åœ¨ä¸¤ä¸ª</p>
<pre><code class="language-c++">
</code></pre>
<!-- more -->

            </div>
            
              <div class="tag-container">
                
                  <a href="https://ray-sang.github.io/tag/J9zXWDJwR/" class="tag">
                    C++åŸºç¡€
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://ray-sang.github.io/post/opencv-ji-chu-nei-rong-bi-ji/">
                  <h3 class="post-title">
                    OpenCVåŸºç¡€å†…å®¹ç¬”è®°
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
